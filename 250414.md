# 250414
## Image Histogram
### Mat í´ë˜ìŠ¤
- ì´ë¯¸ì§€ë¥¼ í–‰ë ¬ í˜•íƒœë¡œ ì €ì¥
- ``` C++
  Mat srcImage = imread("lena.jpg"); // srcImageëŠ” Mat ê°ì²´ì´ê³ , ì´ë¯¸ì§€ íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì„œ ë©”ëª¨ë¦¬ì— ì €ì¥í•¨.
  ```
#### Q. cv::Mat í™œìš© ì´ìœ ?
- Matì€ ë‹¨ìˆœíˆ ì´ë¯¸ì§€ë§Œ ì €ì¥í•˜ëŠ” í´ë˜ìŠ¤ê°€ ì•„ë‹˜. í–‰ë ¬ í˜•íƒœì˜ ë°ì´í„°ë¼ë©´ ì´ë¯¸ì§€ë“  í•„í„° ì»¤ë„ì´ë“  íˆìŠ¤í† ê·¸ë¨ì´ë“  ëª¨ë‘ í‘œí˜„ ê°€ëŠ¥
- calcHist() ê°™ì€ í•¨ìˆ˜ë“¤ì´ íˆìŠ¤í† ê·¸ë¨ ì¶œë ¥ì„ Matìœ¼ë¡œ ë°˜í™˜

### ì´ë¯¸ì§€ ì±„ë„ ë¶„ë¦¬(split)
- ì»¬ëŸ¬ ì´ë¯¸ì§€ëŠ” BGR 3ì±„ë„ë¡œ êµ¬ì„±ë¨. íˆìŠ¤í† ê·¸ë¨ ì²˜ë¦¬ë¥¼ ìœ„í•´ ê° ì±„ë„ì„ ë¶„ë¦¬í•´ì•¼ í•¨.
- ``` C++
  vector<Mat> BGR_planes;
  split(srcImage, BGR_planes); // BGR_planes[0] = Blue ì±„ë„, BGR_planes[1] = Green ì±„ë„, BGR_planes[2] = Red ì±„ë„
  ```

### íˆìŠ¤í† ê·¸ë¨
- í”½ì…€ ê°’ì˜ ë¶„í¬, ì¦‰ ë°ê¸° ê°’(0~255)ì´ ì´ë¯¸ì§€ì— ì–¼ë§ˆë‚˜ ë¶„í¬ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¹ˆë„ìˆ˜ í†µê³„ ê·¸ë˜í”„
- xì¶•: ë°ê¸° ê°’ (0~255)
- yì¶•: í•´ë‹¹ ë°ê¸°ê°’ì„ ê°€ì§„ í”½ì…€ì˜ ê°œìˆ˜ (ë¹ˆë„ ìˆ˜)

- yì¶•
- ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ì´ë¯¸ì§€: í”½ì…€ í•˜ë‚˜ë‹¹ ë°ê¸°ê°’(0~255) â†’ 1ì°¨ì› íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ ì¶©ë¶„
- ì»¬ëŸ¬ ì´ë¯¸ì§€(BGR): í”½ì…€ í•˜ë‚˜ì— 3ê°€ì§€ ê°’(B, G, R) â†’ ë°ê¸° ë¶„í¬ê°€ 3ì±„ë„ë¡œ ë‚˜ë‰¨
- R, G, B ê°ê°ì˜ ë°ê¸° ë¶„í¬ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì»¬ëŸ¬ ì´ë¯¸ì§€ëŠ” íˆìŠ¤í† ê·¸ë¨ë„ 3ê°œ í•„ìš”
- ``` C++
  calcHist(&BGR_planes[c], 1, nullptr, noArray(), hists[c], 1, &histSize, ranges, true, false);
  /*
  images	ì´ë¯¸ì§€ ë°°ì—´. ë³´í†µ &image ë˜ëŠ” &channels[i]
  nimages	ì´ë¯¸ì§€ ê°œìˆ˜ (ë³´í†µ 1ê°œë‹ˆê¹Œ 1)
  channels	ì‚¬ìš©í•  ì±„ë„ ë²ˆí˜¸ ë°°ì—´ (ì˜ˆ: {0} â†’ 0ë²ˆ ì±„ë„ë§Œ ì‚¬ìš©)
  mask	ROI (Region of Interest) ì„¤ì •í•  ë•Œ ì‚¬ìš©. ì—†ìœ¼ë©´ Mat() ë˜ëŠ” noArray()
  hist	ê²°ê³¼ë¥¼ ì €ì¥í•  Mat ê°ì²´
  dims	íˆìŠ¤í† ê·¸ë¨ì˜ ì°¨ì› ìˆ˜ (1D, 2D ë“±)
  histSize	ê° ì°¨ì›ì˜ bin ê°œìˆ˜ (ì˜ˆ: {256} â†’ 256ê°œì˜ ë°ê¸°ê°’ bin)
  ranges	ê° ì°¨ì›ì˜ ê°’ ë²”ìœ„ (ì˜ˆ: {0, 256} â†’ ë°ê¸° 0~255)
  uniform	bin í¬ê¸°ê°€ ì¼ì •í•œê°€? ëŒ€ë¶€ë¶„ true
  accumulate	ì´ì „ ê°’ì— ëˆ„ì í•  ê²ƒì¸ê°€? ë³´í†µ false
  */
  ```
#### ì´ë¯¸ì§€ ë° íˆìŠ¤í† ê·¸ë¨ ì¶œë ¥ ì˜ˆì œ
``` C++
// 1. ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì½ì–´ì˜¤ê¸°.
// 2. í‘ë°± ì´ë¯¸ì§€ì˜ íˆìŠ¤í† ê·¸ë¨ì„ ê³„ì‚°í•˜ê³  ì‹œê°í™”.
// 3. ì»¬ëŸ¬ ì´ë¯¸ì§€ì˜ ê° ì±„ë„ (R, G, B)ë³„ íˆìŠ¤í† ê·¸ë¨ì„ ê³„ì‚°í•˜ê³  ì‹œê°í™”.
// 4. ì›ë³¸ ì´ë¯¸ì§€ì™€ ê·¸ì— ëŒ€ì‘í•˜ëŠ” íˆìŠ¤í† ê·¸ë¨ì„ ë™ì‹œì— ì¶œë ¥

#include <opencv2/opencv.hpp>
#include <iostream>
using namespace cv;
using namespace std;

int main() {
    // ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ë“¤
    int histSize = 256; // 256ê°œì˜ ë°ê¸° bin
    float range[] = { 0, 256 }; // ë°ê¸° ë²”ìœ„ 0~255
    const float* ranges[] = { range }; // íˆìŠ¤í† ê·¸ë¨ ë²”ìœ„
    int hist_w = 512, hist_h = 400; // íˆìŠ¤í† ê·¸ë¨ ì´ë¯¸ì§€ í¬ê¸°
    int bin_w = cvRound((double)hist_w / histSize); // bin ë„ˆë¹„

    // 1. ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    Mat grayImage = imread("í‘ë°±.png", IMREAD_GRAYSCALE); // í‘ë°± ì´ë¯¸ì§€
    Mat colorImage = imread("ì»¬ëŸ¼.png"); // ì»¬ëŸ¬ ì´ë¯¸ì§€ (BGR)

    // 2. í‘ë°± ì´ë¯¸ì§€ì˜ íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°
    if (grayImage.empty()) {
        cerr << "Error: Could not load the grayscale image!" << endl;
        return -1;
    }

    // íˆìŠ¤í† ê·¸ë¨ì„ ì €ì¥í•  Mat ê°ì²´
    Mat grayHist;
    calcHist(&grayImage, 1, 0, Mat(), grayHist, 1, &histSize, ranges, true, false);

    // 3. ì»¬ëŸ¬ ì´ë¯¸ì§€ì˜ íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°
    if (colorImage.empty()) {
        cerr << "Error: Could not load the color image!" << endl;
        return -1;
    }

    // BGR ì±„ë„ ë¶„ë¦¬
    vector<Mat> bgr_planes;
    split(colorImage, bgr_planes); // BGR ì±„ë„ ë¶„ë¦¬

    // ê° ì±„ë„ì˜ íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°
    Mat bHist, gHist, rHist;
    calcHist(&bgr_planes[0], 1, 0, Mat(), bHist, 1, &histSize, ranges, true, false); // Blue
    calcHist(&bgr_planes[1], 1, 0, Mat(), gHist, 1, &histSize, ranges, true, false); // Green
    calcHist(&bgr_planes[2], 1, 0, Mat(), rHist, 1, &histSize, ranges, true, false); // Red

    // 4. íˆìŠ¤í† ê·¸ë¨ ì‹œê°í™”

    // í‘ë°± ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ ìœ„í•œ ë¹ˆ ì´ë¯¸ì§€ ìƒì„±
    Mat grayHistImage(hist_h, hist_w, CV_8UC1, Scalar(255)); // í‘ë°± íˆìŠ¤í† ê·¸ë¨ ì´ë¯¸ì§€

    // í‘ë°± ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ ê·¸ë¦¬ê¸°
    normalize(grayHist, grayHist, 0, grayHistImage.rows, NORM_MINMAX, -1, Mat());
    for (int i = 1; i < histSize; i++) {
        line(grayHistImage, Point(bin_w * (i - 1), hist_h - cvRound(grayHist.at<float>(i - 1))),
                      Point(bin_w * i, hist_h - cvRound(grayHist.at<float>(i))),
                      Scalar(0), 2, 8, 0); // í‘ë°±íˆìŠ¤í† ê·¸ë¨ì€ ê²€ì€ìƒ‰ìœ¼ë¡œ
    }

    // ì»¬ëŸ¬ ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ ìœ„í•œ ë¹ˆ ì´ë¯¸ì§€ ìƒì„±
    Mat colorHistImage(hist_h, hist_w, CV_8UC3, Scalar(255, 255, 255)); // ì»¬ëŸ¬ íˆìŠ¤í† ê·¸ë¨ ì´ë¯¸ì§€

    // ê° ì±„ë„ì˜ íˆìŠ¤í† ê·¸ë¨ì„ ì»¬ëŸ¬ë¡œ ê·¸ë¦¬ê¸°
    normalize(bHist, bHist, 0, colorHistImage.rows, NORM_MINMAX, -1, Mat());
    normalize(gHist, gHist, 0, colorHistImage.rows, NORM_MINMAX, -1, Mat());
    normalize(rHist, rHist, 0, colorHistImage.rows, NORM_MINMAX, -1, Mat());

    for (int i = 1; i < histSize; i++) {
        // Blue ì±„ë„ (íŒŒë€ìƒ‰)
        line(colorHistImage, Point(bin_w * (i - 1), hist_h - cvRound(bHist.at<float>(i - 1))),
                          Point(bin_w * i, hist_h - cvRound(bHist.at<float>(i))),
                          Scalar(255, 0, 0), 2, 8, 0);

        // Green ì±„ë„ (ì´ˆë¡ìƒ‰)
        line(colorHistImage, Point(bin_w * (i - 1), hist_h - cvRound(gHist.at<float>(i - 1))),
                          Point(bin_w * i, hist_h - cvRound(gHist.at<float>(i))),
                          Scalar(0, 255, 0), 2, 8, 0);

        // Red ì±„ë„ (ë¹¨ê°„ìƒ‰)
        line(colorHistImage, Point(bin_w * (i - 1), hist_h - cvRound(rHist.at<float>(i - 1))),
                          Point(bin_w * i, hist_h - cvRound(rHist.at<float>(i))),
                          Scalar(0, 0, 255), 2, 8, 0);
    }

    // 5. ê²°ê³¼ ì¶œë ¥
    imshow("Grayscale Image", grayImage); // í‘ë°± ì´ë¯¸ì§€
    imshow("Grayscale Histogram", grayHistImage); // í‘ë°± ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨

    imshow("Color Image", colorImage); // ì»¬ëŸ¬ ì´ë¯¸ì§€
    imshow("Color Histogram", colorHistImage); // ì»¬ëŸ¬ ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨

    waitKey(0); // í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì¢…ë£Œ
    destroyAllWindows(); // ëª¨ë“  ì°½ ë‹«ê¸°

    return 0;
}


```

  
### íˆìŠ¤í† ê·¸ë¨ ê· ì¼í™”(Equalization)

![image](https://github.com/user-attachments/assets/ea74cd5f-d19c-4744-8845-141169205eff)

1. ê· ì¼í™”
  - ì›ë³¸ ì´ë¯¸ì§€ì˜ ëª…ì•” ë¶„í¬ê°€ íŠ¹ì • êµ¬ê°„ì— ëª°ë ¤ ìˆì„ ê²½ìš°, ì „ì²´ ë²”ìœ„(0~255)ë¥¼ ê³ ë¥´ê²Œ í¼ì§€ê²Œ ë§Œë“¤ì–´ **ëŒ€ë¹„(contrast)**ë¥¼ í–¥ìƒì‹œí‚¤ëŠ” ê¸°ë²•.
  - ì´ë¯¸ì§€ì˜ íˆìŠ¤í† ê·¸ë¨ì„ ê· ì¼í•˜ê²Œ ë¶„í¬ì‹œí‚¤ëŠ” ê¸°ë²•
  - ``` c++
    Mat equalized;
    equalizeHist(grayImage, equalized);
    imshow("Equalized Image", equalized);
    ```
2. ì´ë¯¸ì§€ ë° íˆìŠ¤í† ê·¸ë¨ ë³€í™”
  - ì›ë³¸ ì´ë¯¸ì§€
      - ëª…ì•”ì´ ì¤‘ê°„ ë°ê¸° ê·¼ì²˜ì— ì§‘ì¤‘ë˜ì–´ ìˆê³ , ëŒ€ë¹„ê°€ ë‚®ìŒ.
      - íˆìŠ¤í† ê·¸ë¨ì´ íŠ¹ì • ë°ê¸°ëŒ€ì— ëª°ë ¤ ìˆìŒ.
  - ê· ë“±í™” ì´ë¯¸ì§€
      - ì „ì²´ ë°ê¸° ë²”ìœ„ë¡œ í”½ì…€ ê°’ì´ ë¶„ì‚°ë¨ â†’ ëŒ€ë¹„ê°€ ë†’ì•„ì ¸ ë””í…Œì¼ì´ ì„ ëª…í•˜ê²Œ ë³´ì„.
      - íˆìŠ¤í† ê·¸ë¨ì´ ì „ì²´ì ìœ¼ë¡œ í¼ì ¸ ìˆìŒ.

Q. ```normalize(hists[c], hists[c], 0, hist_h * max_count[c] / max_count_for_all, NORM_MINMAX, -1, noArray());``` ìˆ˜ì‹ì˜ ì˜ë¯¸? 

``` ğŸ§® ì™œ ì´ë ‡ê²Œ ì“°ëŠ”ê°€?
ì˜ˆë¥¼ ë“¤ì–´,
Red ì±„ë„ ìµœëŒ€ê°’: 9000
Green ì±„ë„ ìµœëŒ€ê°’: 4000
Blue ì±„ë„ ìµœëŒ€ê°’: 6000
ì´ ì¤‘ ì „ì²´ ìµœëŒ€ëŠ” 9000 â†’ ì´ê±¸ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŒ

ê·¸ëŸ¬ë©´
RedëŠ” hist_hë¡œ ì •ê·œí™”ë¨ (400)
Greenì€ 400 * 4000 / 9000 â‰ˆ 178
BlueëŠ” 400 * 6000 / 9000 â‰ˆ 267

ì¦‰, ë‹¤ë¥¸ ì±„ë„ë“¤ë„ ê°™ì€ ë†’ì´ ë²”ìœ„ ë‚´ì—ì„œ ìƒëŒ€ì ìœ¼ë¡œ í‘œì‹œë˜ë„ë¡ ë§Œë“œëŠ” ë°©ì‹!
``` 

![image](https://github.com/user-attachments/assets/d1a2864d-54ec-4e78-9a77-eaa1a479c6ba)


## Image Thresholding

## Image Blending
